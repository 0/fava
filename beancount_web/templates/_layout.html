{% set navigation_bar = [
    ("", [
        ('/income_statement/',    'income_stmt',          'Income Statement'),
        ('/balance_sheet/',       'balance_sheet',        'Balance Sheet'),
        ('/trial_balance/',       'trial_balance',        'Trial Balance'),
        ('/journal/',             'journal',              'General Journal'),
    ]),
    ("Other", [
        ('/holdings/',            'holdings',             'Equity/Holdings'),
        ('/net_worth/',           'net_worth',            'Net Worth'),
        ('/documents/',           'documents',            'Documents'),
        ('/notes/',               'notes',                'Notes'),
        ('/events/',              'events',               'Events'),
        ('/commodities/',         'commodities',          'Commodities'),
    ]),
    ("Configuration", [
        ('/source/',             'source',         'Source'),
        ('/options/',            'options',        'Options'),
        ('/statistics/',         'statistics',     'Statistics'),
        ('/errors/',             'errors',         'Errors'),
    ])
] %}
{% set active_page = active_page|default('journal') %}
<!doctype html>
<html>
<head>
    {% block head %}
    <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="shortcut icon" type="image/x-icon" id="favicon"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/styles.css') }}">
    <title>{% block title %}{% endblock %} - {{ title }}</title>
    {% endblock %}
    <script>window.chartData = [];</script>
</head>
<body>
    {% if not options['operating_currency'] %}
        <ul class="warnings">
            <li class="error">
                <div class="warning-wrapper">
                    No <code>operating_currency</code> specified.
                    Add <code>option "operating_currency" "USD"</code> to your beancount file.
                </div>
            </li>
        </ul>
    {% endif %}
    <header>
        <div class="branding">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAsVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+3mHKcAAAAOnRSTlMAAQMEBQYHCAwNDg8QExkaISImJzQ7RUZHSUtVZGtsb3FzdXd4f5WYm56jr7y+xcfP2tze4OLk6/X9+wsXVgAAAMJJREFUKFPFkWkTgiAYhDG1wy677VSzw0q6pKz3//+wBGRkGO2r+4ndZ9hhFoQq0AaXKZoiKFfE4Uzt82iKOWyrcJjDJU90N45dnZ/3HCbrPvfmE64YHkZ216MQi6rwPUBp0VF4GVrQowlAqwA6cN8xKJ4uwyDNGdz+g0EBnAvoFEALxjZC9gIsCd60zJy6ZqpRmFmNLfQ9NJirE7pWbDLTuYj5SI0Fhk+IzwdqfvLhJ0jRSvqVl/rRCYdnKNVG7atcP+gmOQsBuK8NAAAAAElFTkSuQmCC" alt="">
            <h1 class="site-name">{{ title or 'Beancount Web' }}</h1>
        </div>
        <nav>
            <ul class="topmenu">
                <li{% if entry_filters['time'] %} class="selected"{% endif %}>
                    <a href="">
                        <span>{{ entry_filters['time'] or 'Time' }}</span>
                    </a>
                    <div class="filter" id="filter-time">
                        <div class="inputcontainer">
                            <input type="search" class="search-direct-apply" data-url="{{ request.path }}?filter_time=">
                        </div>
                        <ul>
                            {% set time_search_strings = ['this month', '2015-03', 'march 2015', 'mar 2015', 'last year', 'aug last year', '2010-10 - 2014'] %}
                            <li class="info">Supports search strings like
                                {% for suggestion in time_search_strings %}
                                    <a href="{{ request.path }}?filter_time={% if suggestion != entry_filters['time'] %}{{ suggestion }}{% endif %}" data-filter="{{ suggestion }}">{{ suggestion }}</a>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>

                            {% if entry_filters['time'] and entry_filters['time'] not in api.active_years|map('string') %}
                                <li class="suggestion selected" data-filter="{{ entry_filters['time'] }}">
                                    <a href="{{ request.path }}?filter_time=">{{ entry_filters['time'] }}</a>
                                </li>
                            {% endif %}

                            {% for time_ in api.active_years %}
                            <li class="suggestion{% if time_|string == entry_filters['time'] %} selected{% endif %}" data-filter="{{ time_ }}">
                                <a href="{{ request.path }}?filter_time={% if time_|string != entry_filters['time'] %}{{ time_ }}{% endif %}">{{ time_ }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
                <li{% if entry_filters['tags']  %} class="selected"{% endif %}>
                    <a href="">
                        <span>
                            {% if entry_filters['tags'] %}
                                {% if entry_filters['tags']|length == 1 %}
                                    # {{ entry_filters['tags']|first }}
                                {% else %}
                                    Multiple tags
                                {% endif %}
                            {% else %}
                                Tag
                            {% endif %}
                        </span>
                    </a>
                    <div class="filter">
                        <div class="inputcontainer">
                            <input type="search">
                        </div>
                        <ul>
                            <li class="info">You can select multiple tags.</li>

                            {% for tag in api.active_tags %}
                            <li class="suggestion{% if tag in entry_filters['tags'] %} selected{% endif %}" data-filter="{{ tag|lower }}">
                                <a href="{{ request.path }}?{% if tag in entry_filters['tags'] %}remove_filter_tag={{ tag }}{% else %}filter_tag={{ tag }}{% endif %}"># {{ tag }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
                <li{% if entry_filters['account'] %} class="selected"{% endif %}>
                    <a href="">
                        <span>{{ entry_filters['account'] or 'Component' }}</span>
                    </a>
                    <div class="filter">
                        <div class="inputcontainer">
                            <input type="search">
                        </div>
                        <ul>
                            {% for account in api.all_accounts %}
                            <li class="suggestion{% if account.full_name == entry_filters['account'] %} selected{% endif %}" data-filter="{{ account.full_name|lower }}">
                                <a href="{{ request.path }}?filter_account={% if account.full_name != entry_filters['account'] %}{{ account.full_name }}{% endif %}">
                                    {% for i in range(account.depth) %}&ndash;{% endfor %}&nbsp;{{ account.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
                <li{% if entry_filters['payees']  %} class="selected"{% endif %}>
                    <a href="">
                        <span>
                            {% if entry_filters['payees'] %}
                                {% if entry_filters['payees']|length == 1 %}
                                    {{ entry_filters['payees']|first }}
                                {% else %}
                                    Multiple payees
                                {% endif %}
                            {% else %}
                                Payee
                            {% endif %}
                        </span>
                    </a>
                    <div class="filter">
                        <div class="inputcontainer">
                            <input type="search">
                        </div>
                        <ul>
                            <li class="info">You can select multiple payees.</li>

                            {% for payee in api.active_payees %}
                            <li class="suggestion{% if payee in entry_filters['payees'] %} selected{% endif %}" data-filter="{{ payee|lower }}">
                                <a href="{{ request.path }}?{% if payee in entry_filters['payees'] %}remove_filter_payee={{ payee }}{% else %}filter_payee={{ payee }}{% endif %}">{{ payee }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
    </header>
    <div class="main">
        <aside>
            {% for title_, menuitems in navigation_bar %}
                {% if title_ %}<h3>{{ title_ }}</h3>{% endif %}
                <ul class="navigation">
                {% for href, id, caption in menuitems %}
                    <li{% if id == active_page %} class="selected"{% endif %}><a href="{{ href|e }}">{{ caption|e }}{% if id == 'errors' and errors|length > 0 %}<span>{{ errors|length }}</span>{% endif %}</a></li>
                {% endfor %}
                </ul>
            {% endfor %}
        </aside>
        <article>
            {% block content %}{% endblock %}
        </article>
    </div>

    {% assets
            filters="rjsmin",
            output="gen/packed-general.js",
            "vendor/jquery-js/jquery-2.1.4.js",
            "vendor/chartist-js/chartist.js",
            "vendor/chartist-js/chartist-plugin-legend.js",
            "vendor/chartist-js/chartist-plugin-tooltip.js",
            "vendor/jquery-treemap-js/jquery-treemap.js",
            "javascript/helpers.js",
            "javascript/charts.js",
            "javascript/main.js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
    {% block javascript %}{% endblock %}
</body>
</html>
