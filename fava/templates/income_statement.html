{% extends "_layout.html" %}
{% set active_page = 'income_statement' %}

{% import 'macros/_interval_macros.html' as interval_macros with context %}

{% block content %}
    <h1>Income Statement</h1>
    {% set income = api.balances(options['name_income']) %}
    {% set expenses = api.balances(options['name_expenses']) %}

    {% set income_monthly_totals = api.interval_totals(interval_macros.interval, options['name_income']) %}
    {% set expenses_monthly_totals = api.interval_totals(interval_macros.interval, options['name_expenses']) %}
    {% set ie_totals = api.interval_totals(interval_macros.interval, [options['name_income'], options['name_expenses']]) %}

    {% include "charts/_chart_skeleton.html" %}

    {% with label="changes (Income/Expenses)", interval_totals=ie_totals %}
        {% include "charts/_chart_interval_totals.html" %}
    {% endwith %}

    {% with label="income", interval_totals=income_monthly_totals %}
        {% include "charts/_chart_interval_totals.html" %}
    {% endwith %}

    {% with label="expenses", interval_totals=expenses_monthly_totals %}
        {% include "charts/_chart_interval_totals.html" %}
    {% endwith %}

    {% with label="Income", rows=income, modifier=-1 %}
        {% include "charts/_chart_treemap.html" %}
    {% endwith %}

    {% with label="Expenses", rows=expenses %}
        {% include "charts/_chart_treemap.html" %}
    {% endwith %}

    <div class="halfleft">
        {% with table_title="Income", table_data=income, totals=True %}
            {% include "_tree_table.html" %}
        {% endwith %}
    </div>
    <div class="halfright">
        {% with table_title="Expenses", table_data=expenses, totals=True %}
            {% include "_tree_table.html" %}
        {% endwith %}
    </div>
{% endblock %}
